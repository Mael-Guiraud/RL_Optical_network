import pandas as pd
import numpy as np

# Chargement
df = pd.read_csv("nouveau_fichier.csv")



algos = ["min", "min_sa", "POLY", "POLYOPTI", "LRI"]

# Conversion forcée en numérique
for col in algos:
    df[col] = pd.to_numeric(df[col], errors="coerce")

# Vérification
missing = set(algos) - set(df.columns)
if missing:
    raise ValueError(f"Colonnes manquantes : {missing}")

results = {}

# Meilleur par instance
row_min = df[algos].min(axis=1)

for algo in algos:
    values = df[algo]

    # Meilleur (ex aequo)
    best = (values == row_min).sum()

    # Strictement meilleur
    strict_best = (values < df[algos].drop(columns=algo).min(axis=1)).sum()

    results[algo] = {
        "best": best,
        "strict_best": strict_best,
    }

# --- Amélioration par rapport à POLY ---
poly = df["POLY"]

for algo in algos:
    if algo == "POLY":
        continue

    diff = poly - df[algo]
    rel_diff = diff / poly.replace(0, np.nan)

    results[algo].update({
        "better_than_poly": (diff > 0).sum(),
        "mean_gain_vs_poly": diff.mean(),
        "median_gain_vs_poly": diff.median(),
        "mean_relative_gain_vs_poly_%": 100 * rel_diff.mean()
    })

# POLY vs lui-même (référence)
results["POLY"].update({
    "better_than_poly": 0,
    "mean_gain_vs_poly": 0.0,
    "median_gain_vs_poly": 0.0,
    "mean_relative_gain_vs_poly_%": 0.0
})

# --- Rang moyen ---
ranks = df[algos].rank(axis=1, method="min")
for algo in algos:
    results[algo]["mean_rank"] = ranks[algo].mean()

# --- Écart moyen au meilleur ---
for algo in algos:
    results[algo]["mean_gap_to_best"] = (df[algo] - row_min).mean()

# --- Dominance pairwise ---
for algo in algos:
    wins = 0
    for other in algos:
        if algo == other:
            continue
        wins += (df[algo] < df[other]).sum()
    results[algo]["pairwise_wins"] = wins

# Résumé final
summary = pd.DataFrame(results).T.sort_values("mean_rank")
print(summary)

# Sauvegarde
summary.to_csv("stats_algorithmes.csv")
