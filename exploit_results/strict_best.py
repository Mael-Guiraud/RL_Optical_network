import pandas as pd
import numpy as np
from pathlib import Path

# --- Paramètres ---
input_csv = "nouveau_fichier.csv"
out_dir = Path("strict_best_rows")
out_dir.mkdir(parents=True, exist_ok=True)

algos = ["moyenne", "moyenne_sa", "POLY", "POLYOPTI", "LRI"]

# --- Chargement ---
df = pd.read_csv(input_csv)

# Conversion robuste en numérique (évite float vs str)
for col in algos:
    df[col] = pd.to_numeric(df[col], errors="coerce")

# Option (recommandée) : ignorer les lignes où l'algo testé est NaN
# (On garde les lignes même si d'autres algos sont NaN ; c'est un choix raisonnable en pratique)
# Si tu préfères une comparaison uniquement sur lignes complètes: df = df.dropna(subset=algos)

# --- Extraction strict best ---
strict_best_masks = {}

for algo in algos:
    others = [c for c in algos if c != algo]

    # Strict best = valeur(algo) < min(autres) ; si min(autres) est NaN (tous NaN), alors False
    others_min = df[others].min(axis=1, skipna=True)

    mask = df[algo].notna() & others_min.notna() & (df[algo] < others_min)
    strict_best_masks[algo] = mask

    df_algo = df.loc[mask].copy()
    out_path = out_dir / f"strict_best_{algo}.csv"
    df_algo.to_csv(out_path, index=False)

    print(f"{algo}: {mask.sum()} lignes strict best -> {out_path}")

# --- (Optionnel) Un fichier unique avec une colonne 'strict_best_algo' ---
# Remarque: une ligne ne peut être strict-best que pour au plus un algo (par définition).
df_one = df.copy()
df_one["strict_best_algo"] = np.nan
for algo, mask in strict_best_masks.items():
    df_one.loc[mask, "strict_best_algo"] = algo

df_one_out = out_dir / "strict_best_all_algos_labeled.csv"
df_one.to_csv(df_one_out, index=False)
print(f"Fichier global étiqueté -> {df_one_out}")
